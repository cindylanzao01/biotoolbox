#summary Converted POD documentation.
#labels ManPage
_This page was generated from POD using [http://code.google.com/p/pod2gcw pod2gcw] and is not intended for editing._

==NAME==
bam2wig.pl

A script to enumerate Bam alignments or coverage into a wig file.

==SYNOPSIS==
bam2wig.pl `[`--options...`]` <**filename.bam>

{{{
  Options:
  --in <filename.bam>
  --out <filename> 
  --position [start|mid|span|extend]
  --coverage
  --splice|split
  --pe
  --bin <integer>
  --shift
  --shiftval <integer>
  --sample <integer>
  --chrom <integer>
  --minr <float>
  --strand
  --qual <integer>
  --max <integer>
  --rpm
  --log [2|10]
  --bw
  --bwapp </path/to/wigToBigWig or /path/to/bedGraphToBigWig>
  --gz
  --verbose
  --version
  --help
}}}
==OPTIONS==
The command line flags and descriptions:

__--in <**filename>

__
  Specify the input Bam alignment file. The file should be sorted by  genomic position and indexed, although it may be indexed automatically.
__
  __
__--out <**filename>

__
  Specify the output base filename. By default it uses the base name of  the input file.
__
  __
__--position `[`start|mid|span|extend`]`

__
  Specify the position of the alignment coordinate which should be  recorded. Several positions are accepted:
__
  __
{{{
    start     the 5' position of the alignment
    mid       the midpoint of the alignment
    span      along the length of the alignment (coverage)
    extend    along the length of the predicted fragment
              equal to 2 x the shift value (enables --shift) 
    coverage  another way to specify --coverage
     }}}
  With paired-end alignments, the positions are relative to the entire  insert fragment defined by two proper alignments. For single-end  alignments, the default value is coverage if no other options are  specified, otherwise start. For paired-end alignments, the midpoint  position is the default.
__
  __
__--coverage

__
  Quickly calculates the coverage of the alignments over the genome,  either at single bp resolution (default) or in bins. This method ignores  the position, quality, strand, shift, and log options. It is  equivalent to specifying --position=span, --fix, --split,  --nope, --noshift, --nostrand, --qual=0, --max=8000, --norpm, and no log.
__
  __
__--splice

__
__--split

__
  The Bam file alignments may contain splices, where the  read is split between two separate alignments. This is most common  with splice junctions from RNA-Seq data. In this case, treat each  alignment as a separate tag. This only works with single-end alignments.  Splices are disabled for paired-end reads. Note that this will  increase processing time.
__
  __
__--pe

__
  The Bam file consists of paired-end alignments, and only properly  mapped pairs of alignments will be counted. The default is to  treat all alignments as single-end.
__
  __
__--bin <**integer>

__
  Specify the window or bin size in which alignment counts are summed.  This option is compatible with start, mid, and coverage recording  options, but is automatically disabled with span and extend recording  options. The default is to count at single basepair resolution.
__
  __
__--shift

__
  Specify that the positions of the alignment should be shifted towards  the 3' end. Useful for ChIP-Seq applications, where only the ends of  the fragments are counted and often seen as separated discrete peaks  on opposite strands flanking the true target site. This option is  disabled with paired-end and spliced reads (where it is not needed).
__
  __
  The extend position option is a special mode where the entire predicted  ChIP fragment is recorded across the span. The length is 2 x the shift  value.
__
  __
__--shiftval <**integer>

__
  Provide the value in bp that the record position should be shifted.  The value should be 1/2 the average length of the insert library  that was sequenced. The default is to empirically determine the  appropriate shift value. See below for the approach.
__
  __
__--sample <**integer>

__
  Indicate the number of top regions to sample when empirically  determining the shift value. The default is 200.
__
  __
__--chrom <**integer>

__
  Indicate the number of sequences or chromosomes to sample when  empirically determining the shift value. The reference sequences  listed in the Bam file header are taken in order of decreasing  length, and one or more are taken as a representative sample of  the genome. The default value is 2.
__
  __
__--minr <**float>

__
  Provide the minimum R^2 value to accept a shift value when  empirically determining the shift value. Enter a decimal value  between 0 and 1. Higher values are more stringent. The default  is 0.25.
__
  __
__--strand

__
  Indicate that separate wig files should be written for each strand.  The output file basename is appended with either '`_`f' or '`_`r' for  both files. For paired-end RNA-Seq alignments that were generated with  !TopHat**, the XS attribute is honored for strand information.  The default is to take all alignments regardless of strand.
__
  __
__--qual <**integer>

__
  Set a minimum mapping quality score of alignments to count. The mapping quality score is a posterior probability that the alignment was mapped incorrectly, and reported as a -10Log10(P) value, rounded to the nearest integer (range 0..255). Higher numbers are more stringent. For performance reasons, when counting paired-end reads, only the left alignment is checked. The default value is 0 (accept everything).
__
  __
__--max <**integer>

__
  Set a maximum number of duplicate alignments tolerated at a single position.  The default is 1000.
__
  __
__--rpm

__
  Convert the data to Reads (or Fragments) Per Million mapped. This is useful  for comparing read coverage between different datasets. This conversion  is applied before converting to log, if requested. This will increase  processing time, as the alignments must first be counted. Only mapped reads  with a minimum mapping quality are counted. All duplicates are counted.  The default is no RPM conversion.
__
  __
__--log `[`2|10`]`

__
  Transform the count to a log scale. Specify the base number, 2 or  10. The counts are increased by 1 before taking a log transformation,  thus avoiding taking a log of 0. Only really useful with Bam alignment  files with high count numbers. Default is to not transform the count.
__
  __
__--bw

__
  Specify whether or not the wig file should be further converted into  an indexed, compressed, binary !BigWig** file. The default is false.
__
  __
__--bwapp < /path/to/wigToBigWig or /path/to/bedGraphToBigWig >

__
  Specify the full path to Jim Kent's bigWig conversion utility. Two  different utilities may be used, bedGraphToBigWig or wigToBigWig,  depending on the format of the wig file generated. The application  paths may be set in the biotoolbox.cfg file.
__
  __
__--gz

__
  Specify whether (or not) the output file should be compressed with  gzip. The default is compress the output unless a !BigWig** file is  requested.
__
  __
__--verbose

__
  Print the sample correlations when determining the shift value.  The default is false.
__
  __
__--version

__
  Print the version number.
__
  __
__--help

__
  Display this POD documentation.
__
  __
==DESCRIPTION==
This program will enumerate aligned sequence tags and generate a wig,  or optionally !BigWig**, file. Alignments may be counted and recorded  in several different ways. Strict enumeration may be performed and  recorded at either the alignment's start or midpoint position.  Alternatively, either the alignment or fragment may be recorded  across its span. Finally, a basic unstranded, unshifted, and  non-transformed alignment coverage may be generated.

Both paired-end and single-end alignments may be counted. Alignments  with splices (e.g. RNA-Seq) may be counted singly or separately.  Alignment counts may be separated by strand, facilitating analysis of  RNA-Seq experiments.

For ChIP-Seq experiments, the alignment position may be shifted  in the 3' direction. This effectively merges the separate peaks  (representing the ends of the enriched fragments) on each strand  into a single peak centered over the target locus. Alternatively,  the entire predicted fragment may be recorded across its span.  This extended method of recording is analogous to the approach  used by the MACS2 program. The shift value may be empirically  determined from the sequencing data (see below).

The output wig file may be either a variableStep, fixedStep, or  bedGraph format. The file format is dictated by where the alignment  position is recorded. Recording start and midpoint at  single base-pair resolution writes a variableStep wig file. Binned start  or midpoint counts and coverage are written as a fixedStep wig file.  Span and extended positions are written as a bedGraph file.

The wig file may be further converted into a compressed, indexed, binary  bigWig format, dependent on the availability of the appropriate  conversion utilities.

More information about wiggle files can be found at  http://genome.ucsc.edu/goldenPath/help/wiggle.html, bedGraph at  http://genome.ucsc.edu/goldenPath/help/bedgraph.html, and bigWig at  http://genome.ucsc.edu/goldenPath/help/bigWig.html.

==RECOMMENDED SETTINGS==
The type of wig file to generate for your Bam sequencing file can vary  depending on your particular experimental application. Here are a few  common sequencing applications and my recommended settings for generating  the wig or bigWig file.

Straight coverage

__
  To generate a straight-forward coverage map, similar to what most genome  browsers display when using a Bam file as source, use the following  settings:
__
  __
{{{
 bam2wig.pl --coverage --in <bamfile>
}}}
Single-end ChIP-Seq

__
  When sequencing Chromatin Immuno-Precipitation products, one generally  performs a 3' shift adjustment to center the fragment's end reads  over the predicted center and putative target. To adjust the positions  of tag count peaks, let the program empirically determine the shift  value from the sequence data (recommended). Otherwise, if you know  the mean size of your ChIP eluate fragments, you can use the --shiftval  option.
__
  __
  Depending on your downstream applications and/or preferences, you  can record strict enumeration (start positions) or coverage (extend  position).
__
  __
  Finally, to compare ChIP-Seq alignments from multiple experiments,  convert your reads to Reads Per Million Mapped, which will help to  normalize read counts.
__
  __
{{{
 bam2wig.pl --pos start --shift --rpm --in <bamfile>
 }}}
{{{
 bam2wig.pl --pos extend --rpm --in <bamfile>
}}}
Paired-end ChIP-Seq

__
  If both ends of the ChIP eluate fragments are sequenced, then we do not  need to calculate a shift value. Instead, we will simply count at the  midpoint of each properly-mapped sequence pair, or record the defined  fragment span.
__
  __
{{{
 bam2wig.pl --pos mid --pe --rpm --in <bamfile>
 }}}
{{{
 bam2wig.pl --pos span --pe --rpm --in <bamfile>
}}}
Unstranded RNA-Seq

__
  With RNA-Sequencing, we may be interested in either coverage (generating  a transcriptome map) or simple tag counts (differential gene expression),  so we can count in one of two ways.
__
  __
  To compare RNA-Seq data from different experiments, convert the read  counts to Reads Per Million Mapped, which will help to normalize read  counts.
__
  __
{{{
 bam2wig --pos span --rpm --in <bamfile>
 }}}
{{{
 bam2wig --pos mid --rpm --in <bamfile>
}}}
Stranded, single-end RNA-Seq

__
  If the library was generated in such a way as to preserve strand, then  we can separate the counts based on the strand of the alignment. Note  that the reported strand may be accurate or flipped, depending upon  whether first-strand or second-strand synthesized cDNA was sequenced,  and whether your aligner took this into account. Please check the  output wig files in a genome browser to verify which one is which, and  rename appropriately.
__
  __
{{{
 bam2wig --pos span --strand --rpm --in <bamfile>
}}}
{{{
 bam2wig --pos mid --strand --rpm --in <bamfile>
 }}}
Stranded, paired-end RNA-Seq

__
  Strand presents a complication when sequencing both ends of the cDNA  product from a library that preserves orientation. Currently,  the !TopHat** aligner can handle stranded, paired-end RNA-Seq alignments.  Because each pair will align to both strands, the aligner must record  separately which strand the original fragment should align. The !TopHat**  program records an 'XS' attribute for each alignment, and, if present,  bam2wig.pl will use this to set the strand.
__
  __
{{{
 bam2wig --pe --pos span --strand --rpm --in <bamfile>
}}}
{{{
 bam2wig --pe --pos mid --strand --rpm --in <bamfile>
 }}}
==SHIFT VALUE DETERMINATION==
To determine the shift value, the top 500 bp regions (the default number is 200 regions) with the highest coverage are collected from the largest chromosome or sequence represented in the Bam file. The largest chromosome is used merely as a representative fraction of the genome for performance reasons rather than random sampling. Stranded read counts are collected in 10 bp bins over the region and flanking 400 bp regions (1.3 kb total). A Pearson product-moment correlation coefficient is then reiteratively determined between the stranded data as the bins are shifted from 30 to 400 bp. The shift corresponding to the highest R squared value is retained for each sampled region. The default minimum R^2 value to keep is 0.25, and not all sampled regions may return a significant R^2 value. A trimmed mean is then calculated from all of the calculated shift values to be used used as the final shift value. This approach works best with clean, distinct peaks. The peak shift may be evaluated by viewing separate, stranded wig files together with the shifted wig file in a genome browser.

==AUTHOR==
{{{
 Timothy J. Parnell, PhD
 Howard Hughes Medical Institute
 Dept of Oncological Sciences
 Huntsman Cancer Institute
 University of Utah
 Salt Lake City, UT, 84112
}}}
This package is free software; you can redistribute it and/or modify it under the terms of the GPL (either version 1, or at your option, any later version) or the Artistic License 2.0.

